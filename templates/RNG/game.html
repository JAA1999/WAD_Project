{% extends 'RNG/base.html' %}

{% load staticfiles %}

{% block body_block %}

<div class="body centre">
	{% if game %}
    <div class = "mostViewed centre">
        <div class = "MVimageBlock ib">
			<img src="/media/game_images/{{ game.file_name }}/" />
		</div>
        <div class = "MVtext center">
            <div class = "MVTitle centre">{{game.name}}</div>          
            <div class = "MVdescription centre">
                <div>{{game.description}}</div>
            </div>
			<div class="rating_container right">
				<div class="ib">Average Critic rating:</div>
				<div class = "rating ib"><p class="fc right">{{av_critic}}</p></div>
			</div>
			<div class="rating_container right">
				<div class="ib">Average User rating:</div>
				<div class = "rating ib"><p class="fc right">{{av_user}}</p></div>
			</div>
		</div>
        
    </div>
	<div class = "leaveRating">
		<div class= "MVTitle ib">Rate This Game</div>
		{% if user.is_authenticated %}
			{% if rated == True %}
				<p>
				You have already left a rating for this game.
			{% else %}
				<form method='POST' action=".">
					{% csrf_token %}
					{{ rating_form.as_p }}
				<input type="submit" value="submit" button class="signin">
			</form>
			{% endif %}
		{% else %}
			<br />
			Only signed in users can leave ratings. You can <a href="{% url 'auth_login' %}">sign in here</a> or 
			<a href="{% url 'registration_register' %}">sign up here!</a>
		{% endif %}
		<p>
	</div>
		
		<div class="comments">
			<div class= "MVTitle ib">{{ comments.count }} Comment{{ comments|pluralize }}</div>
			{% if user.is_authenticated %}
				<form method='post' action=".">
					{% csrf_token %}
					{{ comment_form.as_p }}
				<input type="submit" value="Comment" button class="signin">
				</form>
			{% else %}
				<br />
				Only signed in users can leave comments. You can <a href="{% url 'auth_login' %}">sign in here</a> or 
				<a href="{% url 'registration_register' %}">sign up here!</a>
			{% endif %}
			
			{% for comment in comments %}
				<hr>
				<b>{{ comment.user }}{% if user.critic %} (critic){% endif %}</b><br />
				<p>{{ comment.content }}</p>
				<p>{{ comment.timestamp }}</p>
				<hr>
			{% endfor %}
		</div>
	{% else %}
		Something went wrong.
	{% endif %}
    
</div>
{% endblock %}